<!DOCTYPE html>
<html>
  <head>
    <title>Proximity Events</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script src='http://www.w3.org/Tools/respec/respec-w3c-common' class='remove' async></script>
    <!--script src='http://dev.w3.org/2009/dap/ReSpec.js/js/respec.js' class='remove'></script-->
    <script class="remove">
      var respecConfig = {
          specStatus:           "ED",
          shortName:            "proximity",
          //publishDate:          "2012-12-06",
          previousPublishDate:  "2012-07-12",
          previousMaturity:     "WD",
          edDraftURI:           "http://dvcs.w3.org/hg/dap/raw-file/tip/proximity/Overview.html",
          //lcEnd:                "yyyy-mm-dd",
          editors:  [
              { name: "Anssi Kostiainen", company: "Nokia", companyURL: "http://nokia.com/" },
              { name: "Dzung D Tran", company: "Intel", companyURL: "http://intel.com/" }
          ],
          inlineCSS:    true,
          noIDLIn:      true,
          //extraCSS:     ["../ReSpec.js/css/respec.css"],
          extraCSS:     ["http://dev.w3.org/2009/dap/ReSpec.js/css/respec.css"],
          wg:           "Device APIs Working Group",
          wgURI:        "http://www.w3.org/2009/dap/",
          wgPublicList: "public-device-apis",
          wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/43696/status",
          testSuiteURI: "http://w3c-test.org/dap/proximity/tests/"
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      This specification defines a means to receive events that correspond to
      a proximity sensor detecting the presence of a physical object.
    </section>
    
    <section id="sotd">
      <p>
        The functionality described in this specification was initially
        specified as part of the
        <a href="http://dvcs.w3.org/hg/dap/raw-file/tip/sensor-api/Overview.html">
        Sensor API</a> but has been extracted in order to be more
        straightforward to implement, and in order to produce a specification
        that could be implemented on its own merits without interference with
        other features.
      </p>
    </section>
    
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        The <a>DeviceProximityEvent</a> interface provides web developers
        information about the distance between the hosting device and a
        nearby object.
      </p>
      <p>
        The <a>UserProximityEvent</a> interface provides web developers
        a user-agent- and platform-specific approximation that the hosting
        device has sensed a nearby object.
      </p>
      <p>
        This is achieved by interrogating a proximity sensor of a device, which
        is a sensor that can detect the presence of a physical object without
        physical contact. Not all devices contain a proximity sensor, and when
        there is no proximity sensor, this API is still exposed to the
        scripting environment but it does nothing.
      </p>
      <p>
        Because most proximity sensors detect electromagnetic radiation (e.g.,
        an infrared light or a magnetic field), certain material properties can
        interfere with the sensor's ability to sense the presence of a physical
        object. Things that can interfere with a sensor include, but are not
        limited to, the material's translucency, reflectiveness, color,
        temperature, chemical composition, and even the angle at which the
        object is reflecting the radiation back at the sensor. As such,
        proximity sensors should not be relied on as a means to measure
        distance: the only thing that can be deduced from a proximity sensor is
        that an object is somewhere in the distance between the minimum sensing
        distance and the maximum sensing distance with some degree of
        certainty.
      </p>
    </section>
    
    <section id="conformance">
      <p>
        This specification defines conformance criteria that apply to a single
        product: the <dfn>user agent</dfn> that implements the
        interfaces that it contains.
      </p>
    </section>
    
    <section>
      <h2>Terminology</h2>
      <p>
        The <code><a href="http://dev.w3.org/html5/spec/webappapis.html#eventhandler">
        EventHandler</a></code> interface represents a callback used for event
        handlers as defined in [[!HTML5]].
      </p>
      <p>
        The concepts <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#queue-a-task">
        queue a task</a></dfn> and
        <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">
        fires a simple event</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>
        The terms <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handlers">
        event handlers</a></dfn> and
        <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
        event handler event types</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>The concepts <dfn>
      <a href="http://dom.spec.whatwg.org/#constructing-events">
      create an event</a></dfn> and <dfn>
      <a href="http://dom.spec.whatwg.org/#firing-events">
      fire an event</a></dfn> are defined in [[!DOM4]].
      <p>
        The <dfn>current device proximity</dfn> is a value that represents the
        proximity of the hosting device to a physical object (i.e., some value
        between the <a>maximum sensing distance</a> and the <a>minimum sensing
        distance</a>), in centimeters.
      </p>
      <p>
        The <dfn>minimum sensing distance</dfn> at which the sensor can detect
        a physical object, in centimeters.
      </p>
      <p>
        The <dfn>maximum sensing distance</dfn> at which the sensor can detect
        a physical object, in centimeters.
      </p>
      <p>
        The <dfn>current user proximity state</dfn>, a boolean state, is a
        user-agent- and platform-specific approximation of the closeness of a
        physical object with the hosting device.
      </p>
    </section>
    
    <section>
      <h2>Security and privacy considerations</h2>
      <p>
      </p>
    </section>
    
    <section>
      <h2>Device proximity</h2>
      <p>
        The HTML5 specification [[!HTML5]] defines a <a>Window</a> interface,
        which this specification extends:
      </p>
      <dl title="partial interface Window" class="idl">
        <dt>attribute EventHandler ondeviceproximity</dt>
        <dd>
        </dd>
      </dl>
      <p>
        The <code>ondeviceproximity</code> event handler and its corresponding
        event handler event type <code>deviceproximity</code> MUST be supported
        as an IDL attribute by all objects implementing the <a>Window</a>
        interface.
      </p>
      <section>
        <h2><a>DeviceProximityEvent</a> Interface</h2>
        <dl title="[Constructor (DOMString type, optional DeviceProximityEventInit eventInitDict)]
                   interface DeviceProximityEvent : Event"
            class="idl" data-merge='DeviceProximityEventInit'>
          <dt>readonly attribute double value</dt>
          <dd>
            The <a>current device proximity</a>.
          </dd>
          <dt>readonly attribute double min</dt>
          <dd>
            The <a> minimum sensing distance</a>.
          </dd>
          <dt>readonly attribute double max</dt>
          <dd>
            The <a>maximum sensing distance<strong></strong></a>.
          </dd>
        </dl>
        <dl title="dictionary DeviceProximityEventInit : EventInit" class='idl'>
          <dt>
            double value
          </dt>
          <dd></dd>
          <dt>
            double min
          </dt>
          <dd></dd>
          <dt>
            double max
          </dt>
          <dd></dd>
        </dl>
        <p>
          The <code>value</code> attribute MUST return the value it was
          initialized to. When the object is created, this attribute MUST be
          initialized to positive Infinity. It represents the <a>current device
          proximity</a>.
        </p>
        <p>
          The <code>min</code> attribute MUST return the value it was
          initialized to. When the object is created, this attribute MUST be
          initialized to negative Infinity. It represents the <a>minimum sensing
          distance</a>.
        </p>
        <p>
          The <code>max</code> attribute MUST return the value it was
          initialized to. When the object is created, this attribute MUST be
          initialized to positive Infinity. It represents the <a>maximum sensing
          distance</a>.
        </p>
        <p>
          When a <dfn>user agent</dfn> is required to <dfn>fire a device
          proximity event</dfn>, the <dfn>user agent</dfn> MUST run the
          following steps:
        </p>
        <ol class="rule">
          <li>
            <a>Create an event</a> that uses the <a>DeviceProximityEvent</a>
            interface, with the name <code>deviceproximity</code>, which
            bubbles, is not cancelable, and has no default action, that also
            meets the following conditions:
            <ol>
              <li>
                If the implementation is unable to report the <a>current
                device proximity</a>, initialize the <code>value</code>
                attribute to positive Infinity, otherwise initialize the
                attribute to the <a>current device proximity</a>.
              </li>
              <li>
                 If the implementation is unable to report the <a>minimum
                 sensing distance</a>, initialize the <code>min</code>
                 attribute to negative Infinity, otherwise initialize the
                 attribute to the <a>minimum sensing distance</a>.
              </li>
              <li>
                 If the implementation is unable to report the <a>maximum
                 sensing distance</a>, initialize the <code>max</code>
                 attribute to positive Infinity, otherwise initialize the
                 attribute to the <a>maximum sensing distance</a>.
              </li>
            </ol>
          </li>
        </ol>
        <p>
          When the <a>current device proximity</a> changes, the <dfn>user
          agent</dfn> MUST queue a task to <a>fire a device proximity event</a>
          at the <a>Window</a> object.
        </p>
        <div class="note">
          The definition of granularity i.e. how often the event is fired is
          left to the implementation. Implementations can fire the event if
          they have reason to believe that the page does not have sufficiently
          fresh data. Different devices can also support different minimum and
          maximum sensing distances as well as different resolution, thus
          authors are strongly advised to use the <a>UserProximityEvent</a>
          interface if they are only interested in finding out if the user is
          near or far.
        </div>
        <section>
          <h2>Event handlers</h2>
          <p>
            The following are the <a>event handlers</a> (and their corresponding
            <a>event handler event types</a>) that MUST be supported as
            attributes by the <a>Window</a> object:
          </p>
          <table class="simple">
            <thead>
              <tr>
                <th>event handler</th>
                <th>event handler event type</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong><code>ondeviceproximity</code></strong></td>
                <td><code>deviceproximity</code></td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
    </section>
      
    <section>
      <h2>User proximity</h2>
      <p>
        The HTML5 specification [[!HTML5]] defines a <a>Window</a> interface,
        which this specification extends:
      </p>
      <dl title="partial interface Window" class="idl">
        <dt>attribute EventHandler onuserproximity</dt>
        <dd>
        </dd>
      </dl>
      <p>
        The <code>onuserproximity</code> event handler and its corresponding
        event handler event type <code>userproximity</code> MUST be supported
        as an IDL attribute by all objects implementing the <a>Window</a>
        interface.
      </p>
      <section>
        <h2><a>UserProximityEvent</a> Interface</h2>
        <dl title="[Constructor (DOMString type, optional UserProximityEventInit eventInitDict)]
                   interface UserProximityEvent : Event"
            class="idl" data-merge='UserProximityEventInit'>
          <dt>readonly attribute boolean near</dt>
          <dd>
            The <a>current user proximity state</a>.
          </dd>
        </dl>
        <dl title="dictionary UserProximityEventInit : EventInit" class='idl'>
          <dt>
            boolean near
          </dt>
          <dd></dd>
        </dl>
        <p>
          The <code>near</code> attribute MUST return the value it was
          initialized to. When the object is created, this attribute MUST be
          initialized to false. It represents the <a>current user proximity
          state</a>.
        </p>
        <p>
          When a <dfn>user agent</dfn> is required to <dfn>fire a user
          proximity event</dfn>, the <dfn>user agent</dfn> MUST run the
          following steps:
        </p>
        <ol class="rule">
          <li>
            <a>Create an event</a> that uses the <a>UserProximityEvent</a>
            interface, with the name <code>userproximity</code>, which bubbles,
            is not cancelable, and has no default action, that also meets the
            following conditions:
            <ol>
              <li>
                If the implementation is unable to report the <a>current user
                proximity state</a>, initialize the <code>near</code> attribute
                to false, otherwise initialize the attribute to the <a>current
                user proximity state</a>.
              </li>
            </ol>
          </li>
        </ol>
        <p>
          When the <a>current user proximity state</a> changes, the <dfn>user
          agent</dfn> MUST queue a task to <a>fire a user proximity event</a>
          at the <a>Window</a> object.
        </p>
        <section>
          <h2>Event handlers</h2>
          <p>
            The following are the <a>event handlers</a> (and their corresponding
            <a>event handler event types</a>) that MUST be supported as
            attributes by the <a>Window</a> object:
          </p>
          <table class="simple">
            <thead>
              <tr>
                <th>event handler</th>
                <th>event handler event type</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong><code>onuserproximity</code></strong></td>
                <td><code>userproximity</code></td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
    </section>
    
    <section class="appendix">
      <h2>Acknowledgements</h2>
      <p>
        Doug Turner for the initial prototype. All Device APIs working group
        participants who have sent helpful feedback. Marcos Caceres for his
        excellent work on the test suite.
      </p>
    </section>
  </body>
</html>
